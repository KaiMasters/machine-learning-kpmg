const Product = require('./productModel');
const { validationResult } = require('express-validator');
const MachineLearner = require('../../models/machineLearner');

exports.getProducts = (req, res, next) => {
  console.log('Obtaining products from the database...');
  res.json('Obtaining products is working!');
  console.log('Successfully returned products');
};

exports.createProduct = (req, res, next) => {
  console.log('New product is being inserted into the database');
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    return res.status(422).json({errors: errors.array()});
  }

  const newProduct = req.body;
  Product.create(newProduct)
    .then(createdProduct => {
      console.log('New product successfully inserted');
      return res.status(201).json('Successfully created new product!')
    })
    .catch(err => {
      console.log(`Error creating new product: ${err}`);
      res.status(500).json(`Error creating new product: ${err}`)
    });
};

exports.recommendProducts = async (req, res, next) => {
   MachineLearner.recommend("5dc9407ca6aca9469c8559b7")
    .then(data => {
      console.log(data);
      return res.json(data)
    })
    .catch(err => console.log(`Error occurred: ${err}`));
   // res.json({
   //   orderedSimilarities: {
   //     "0.8427587296358087": 44,
   //     "0.8265478484803244": 74,
   //     "0.816663837537691": 96,
   //     "0.8093123670523971": 20,
   //     "0.7882245255169665": 12,
   //     "0.7873306709555475": 35,
   //     "0.7842293786410625": 67,
   //     "0.7837588459509752": 80,
   //     "0.7804827245559053": 72,
   //     "0.7779027625252615": 82,
   //     "0.7748284575451169": 3,
   //     "0.7730294617998203": 47,
   //     "0.7721423337385555": 17,
   //     "0.7712010004259816": 60,
   //     "0.771000371455226": 14,
   //     "0.7702035180706587": 26,
   //     "0.7699811257247114": 84,
   //     "0.7698733426684824": 30,
   //     "0.7678920668020818": 13,
   //     "0.7675704066479654": 45,
   //     "0.7672614925140265": 54,
   //     "0.7615004904384214": 83,
   //     "0.7572859033422824": 97,
   //     "0.7570050369517815": 66,
   //     "0.7564181372605338": 23,
   //     "0.7562005986532184": 40,
   //     "0.7541988212861687": 69,
   //     "0.7540799055722046": 5,
   //     "0.753795929814053": 59,
   //     "0.7514653795310121": 34,
   //     "0.750671725668062": 49,
   //     "0.7500999009297498": 24,
   //     "0.7477058239631779": 7,
   //     "0.7466964238877479": 61,
   //     "0.7439335508049755": 22,
   //     "0.7428817389446719": 70,
   //     "0.7416739207303221": 94,
   //     "0.740687009110834": 38,
   //     "0.7397583730678635": 4,
   //     "0.7394836720499616": 87,
   //     "0.7387158901499764": 95,
   //     "0.7372273941917868": 42,
   //     "0.7372204731427522": 32,
   //     "0.7360802058244793": 77,
   //     "0.7356153734812522": 25,
   //     "0.73406478499575": 16,
   //     "0.7335651171186901": 71,
   //     "0.7295345926082197": 99,
   //     "0.728987629118336": 51,
   //     "0.7279779854604003": 57,
   //     "0.7271300895330218": 79,
   //     "0.7256374884148427": 78,
   //     "0.7234426209092534": 86,
   //     "0.7232389248223469": 2,
   //     "0.7230608511031569": 93,
   //     "0.7222211357429548": 91,
   //     "0.7220874908203808": 31,
   //     "0.7183194409301489": 18,
   //     "0.717700456319511": 9,
   //     "0.7175498193192059": 58,
   //     "0.716650312664046": 8,
   //     "0.714446748647441": 88,
   //     "0.7143068405667253": 33,
   //     "0.7142582208445015": 41,
   //     "0.7131193173573828": 62,
   //     "0.7107777597493427": 64,
   //     "0.7098830838304455": 52,
   //     "0.7068664885783582": 81,
   //     "0.7031919007565404": 37,
   //     "0.7024901573070339": 76,
   //     "0.7012749256509447": 46,
   //     "0.6990967450536524": 43,
   //     "0.697898161103706": 0,
   //     "0.6906026783501693": 56,
   //     "0.6871537581484699": 90,
   //     "0.6869861119955866": 50,
   //     "0.6866592401138789": 28,
   //     "0.6860236414092508": 1,
   //     "0.6841553586640787": 27,
   //     "0.6826067908970244": 10,
   //     "0.6818964847968646": 19,
   //     "0.6814397311354771": 89,
   //     "0.6794083925843651": 55,
   //     "0.6749568306503902": 15,
   //     "0.6671227897423729": 85,
   //     "0.6637146446278587": 68,
   //     "0.6561655406587079": 73,
   //     "0.6544534233264806": 21,
   //     "0.6520741994391868": 6,
   //     "0.6465532418884292": 63,
   //     "0.6461350845505823": 29,
   //     "0.6438080446934238": 39,
   //     "0.6412838342940448": 48,
   //     "0.6394972586735101": 65,
   //     "0.6378711393158805": 36,
   //     "0.6311453012349506": 98,
   //     "0.6282701773386566": 75,
   //     "0.626454712115463": 53,
   //     "0.6253396224005436": 11,
   //     "0.6211694198830326": 92
   //   },
   //   similaritySum: 7.93847859,
   //   recommendedProducts: [
   //     "5dc8dbebc765e4469c504380",
   //     "5dc8dbebc765e4469c504394",
   //     "5dc8dbebc765e4469c50437b",
   //     "5dc8dbebc765e4469c50436b",
   //     "5dc8dbebc765e4469c504392"
   //   ]
   // });
};